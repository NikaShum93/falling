<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Grimoire of Reading ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
<link id="gfLink" rel="stylesheet" href="">
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0e1a15; --card:#11251e; --card-hover:#142b23;
    --ink:#e9f2e9; --ink-d:#cfe2d2; --line:#1e3e30; --accent:#34d399;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%}
  body{background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  header{padding:24px 16px 8px;text-align:center}
  h1{margin:0;font-size:clamp(22px,3.4vw,38px);font-family:"Cinzel Decorative",serif;color:#bfffe3;text-shadow:0 0 18px #1c6e52}
  .wrap{max-width:1160px;margin:0 auto;padding:0 16px 28px;display:grid;gap:16px}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width:980px){ .grid2{grid-template-columns:1fr} }
  .card{background:var(--card);border-radius:12px;padding:16px 14px;transition:background .2s ease}
  .card:hover{background:var(--card-hover)}
  .card h2{margin:0 0 10px;font-size:18px;color:#b2f2da}
  .row{display:grid;grid-template-columns:220px 1fr;gap:10px;align-items:center;margin:10px 0}
  @media (max-width:720px){ .row{grid-template-columns:1fr} }
  label.lbl{color:#b2f2da;font-weight:800}
  input,textarea,select{width:100%;background:#0a1c15;color:var(--ink);border:1.5px solid #164632;border-radius:10px;padding:10px 12px}
  textarea{min-height:110px;resize:vertical}
  .sw{display:flex;align-items:center;gap:10px}
  .swatch{width:34px;height:34px;border-radius:8px;border:2px solid #2a6b4f;cursor:pointer;box-shadow:0 2px 8px #052019aa}
  input[type=color].picker{position:absolute;opacity:0;width:0;height:0;border:0;padding:0}
  .value{min-width:46px;text-align:right;color:var(--ink-d);font-variant-numeric:tabular-nums}
  .toggle{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid #1f4b37;background:#0b1f17;border-radius:10px}
  .stack{display:flex;gap:10px;flex-wrap:wrap}
  .btn{background:linear-gradient(90deg,#20c997 0,#10b981 100%);color:#083a2b;border:none;border-radius:10px;padding:10px 14px;font-weight:900;cursor:pointer}
  .status{padding:10px;border-radius:10px;background:#0c2018;border:1px solid #214d39;display:none}
  .ok{color:#b8ffd6}.bad{color:#ffbbbb}.warn{color:#ffe3a6}
  .code{border-radius:10px;background:#0a1e17}
  #out{width:100%;min-height:90px;border:none;background:transparent;color:var(--ink);padding:12px;font-family:ui-monospace,Consolas,monospace;white-space:pre}
  iframe{width:100%;height:440px;border:none;border-radius:12px}
</style>
</head>
<body>
<header><h1>Grimoire of Reading ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</h1></header>

<div class="wrap">

  <!-- –¢–µ–∫—Å—Ç -->
  <section class="card">
    <h2>–¢–µ–∫—Å—Ç</h2>
    <div class="row">
      <label class="lbl" for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
      <input id="title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Autumn Days" value="Autumn Days">
    </div>
    <div class="row">
      <label class="lbl" for="text">–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç</label>
      <textarea id="text" placeholder="–ê–±–∑–∞—Ü—ã —Ä–∞–∑–¥–µ–ª—è–π –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π">The days grow colder and the nights grow longer. Leaves change their colour ‚Äî from green to gold, orange, and red.

The wind blows softly through the trees, making the branches sway. Children play outside, kicking leaves high into the air.

Sometimes a cloud hides the pale sun, and rain begins to fall. In the evening, families stay inside, drinking hot cocoa and telling stories by the fire.

Autumn is a time of change ‚Äî a bright and cosy season before the snow.</textarea>
    </div>
  </section>

  <div class="grid2">

    <!-- –®—Ä–∏—Ñ—Ç/—Ü–≤–µ—Ç -->
    <section class="card">
      <h2>–®—Ä–∏—Ñ—Ç –∏ —Ü–≤–µ—Ç</h2>
      <div class="row">
        <label class="lbl" for="fontPreset">–ì–∞—Ä–Ω–∏—Ç—É—Ä–∞</label>
        <select id="fontPreset"></select>
      </div>
      <div class="row">
        <label class="lbl" for="fontSize">–†–∞–∑–º–µ—Ä (px)</label>
        <input type="number" id="fontSize" min="16" max="72" value="28">
      </div>
      <div class="row">
        <label class="lbl">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
        <div class="sw">
          <div id="textColorBox" class="swatch"></div>
          <input id="textColor" class="picker" type="color" value="#fff8e1">
        </div>
      </div>
    </section>

    <!-- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ -->
    <section class="card">
      <h2>–ü–æ–¥—Å–≤–µ—Ç–∫–∞</h2>
      <div class="row">
        <label class="lbl">–¶–≤–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <div class="sw">
          <div id="highlightColorBox" class="swatch"></div>
          <input id="highlightColor" class="picker" type="color" value="#ffd700">
        </div>
      </div>
      <div class="row">
        <label class="lbl" for="highlightOpacity">–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <div style="display:flex;align-items:center;gap:10px">
          <input id="highlightOpacity" type="range" min="0" max="1" step="0.05" value="0.30" style="flex:1">
          <span id="hoVal" class="value">0.30</span>
        </div>
      </div>
      <div class="row">
        <label class="lbl" for="highlightStyle">–¢–∏–ø –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <select id="highlightStyle">
          <option value="background" selected>–ü–æ–¥–ª–æ–∂–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</option>
          <option value="text">–¶–≤–µ—Ç –±—É–∫–≤</option>
        </select>
      </div>
    </section>

  </div>

  <div class="grid2">
    <!-- –§–æ–Ω –∏ —Ä–∞–º–∫–∞ -->
    <section class="card">
      <h2>–§–æ–Ω –∏ —Ä–∞–º–∫–∞</h2>
      <div class="row">
        <label class="lbl">–§–æ–Ω ‚Äî —Ü–≤–µ—Ç</label>
        <div class="sw">
          <div id="bgColorBox" class="swatch"></div>
          <input id="bgColor" class="picker" type="color" value="#0b271f">
        </div>
      </div>
      <div class="row">
        <label class="lbl" for="bgOpacity">–§–æ–Ω ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å</label>
        <div style="display:flex;align-items:center;gap:10px">
          <input id="bgOpacity" type="range" min="0" max="1" step="0.05" value="0.75" style="flex:1">
          <span id="boVal" class="value">0.75</span>
        </div>
      </div>
      <div class="row">
        <label class="lbl">–¶–≤–µ—Ç —Ä–∞–º–∫–∏</label>
        <div class="sw">
          <div id="borderColorBox" class="swatch"></div>
          <input id="borderColor" class="picker" type="color" value="#34d399">
        </div>
      </div>
      <div class="row">
        <label class="lbl" for="borderRadius">–°–∫—Ä—É–≥–ª–µ–Ω–∏–µ (0‚Äì1000)</label>
        <input type="number" id="borderRadius" min="0" max="1000" value="18">
      </div>
      <div class="row">
        <label class="lbl">–û–ø—Ü–∏–∏</label>
        <label class="toggle"><input type="checkbox" id="noBorder"> –±–µ–∑ —Ä–∞–º–∫–∏</label>
      </div>
    </section>

    <!-- –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ -->
    <section class="card">
      <h2>–í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ</h2>
      <div class="row">
        <label class="lbl" for="fw">–®–∏—Ä–∏–Ω–∞ iframe</label>
        <input type="number" id="fw" value="900" min="300" max="3000">
      </div>
      <div class="row">
        <label class="lbl" for="fh">–í—ã—Å–æ—Ç–∞ iframe</label>
        <input type="number" id="fh" value="520" min="200" max="3000">
      </div>
      <div class="row">
        <label class="lbl">–†–∞–∑—Ä–µ—à–µ–Ω–∏—è</label>
        <div class="stack">
          <label class="toggle"><input type="checkbox" id="allowMic" checked> microphone</label>
          <label class="toggle"><input type="checkbox" id="allowAutoplay" checked> autoplay</label>
          <label class="toggle"><input type="checkbox" id="allowFs" checked> allowfullscreen</label>
        </div>
      </div>

      <div class="stack" style="margin-top:8px">
        <button class="btn" id="publishBtn" type="button">üß™ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å JSON</button>
        <button class="btn" id="copyBtn" type="button">üìã –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å IFRAME</button>
      </div>
      <div class="status" id="status"></div>
    </section>
  </div>

  <!-- –ö–æ–¥ –∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
  <section class="card">
    <h2>–ö–æ–¥ –∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h2>
    <div class="code"><textarea id="out" readonly></textarea></div>
    <iframe id="preview" allow="microphone; autoplay"></iframe>
  </section>
</div>

<script>
/* ===== –ö–æ–Ω—Ñ–∏–≥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π) ===== */
const ENDPOINT_BASE = "https://server-kjnn.onrender.com";
const PUBLISH_ROUTES = ["/publish", "/save"];
const PUBLISH_KEY   = "nika_read_pub_2025";
const BASE_MAIN     = "https://nikashum93.github.io/readingtrainer/main.html";
const JSON_BASE     = "https://nikashum93.github.io/texts/data/";

let LAST_ID = localStorage.getItem('rt_last_id') || "";

/* –£—Ç–∏–ª–∏—Ç—ã */
const $ = id => document.getElementById(id);
const statusBox = $("status");
function setStatus(html, cls=''){ statusBox.style.display='block'; statusBox.className='status '+cls; statusBox.innerHTML=html; }
function slug(s){return (s||'untitled').toString().toLowerCase().normalize('NFKD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').slice(0,40)||'note'}
function stamp(){const d=new Date(),p=n=>String(n).padStart(2,'0');return`${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}-${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}`}

/* ‚Ä¶ —Ç–≤–æ–π –∫–æ–¥ –≤—ã–±–æ—Ä–∞ —à—Ä–∏—Ñ—Ç–æ–≤, —Ü–≤–µ—Ç–æ–≤ –∏ –ø—Ä. –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Ä¶ */

/* ===== –ü—É–±–ª–∏–∫–∞—Ü–∏—è ===== */
async function publish(){
  const jsonData = { title: $("title").value.trim(), text: $("text").value };
  const id = `${slug(jsonData.title)}-${stamp()}`;

  const tryRoutes = async () => {
    for (const path of PUBLISH_ROUTES) {
      try {
        const url = ENDPOINT_BASE + path;
        const body = path === "/publish"
          ? { id, folder:"data", mode:"json", content: JSON.stringify(jsonData, null, 2) }
          : { id, type:"falling", data: jsonData };

        const res = await fetch(url, {
          method:"POST",
          headers:{ "Content-Type":"application/json", "X-Publish-Key": PUBLISH_KEY },
          body: JSON.stringify(body)
        });
        if(!res.ok) throw new Error(await res.text().catch(()=>res.statusText));
        const data = await res.json().catch(()=> ({}));
        return data.id || id;
      } catch(e){ console.warn("fail on", path, e); }
    }
    throw new Error("–°–µ—Ä–≤–µ—Ä –Ω–µ –ø—Ä–∏–Ω—è–ª –ø—É–±–ª–∏–∫–∞—Ü–∏—é");
  };

  try {
    setStatus("üîÆ –ü—É–±–ª–∏–∫—É—é‚Ä¶","warn");
    LAST_ID = await tryRoutes();
    localStorage.setItem('rt_last_id', LAST_ID);
    setStatus(`‚úÖ –ì–æ—Ç–æ–≤–æ! ID: <b>${LAST_ID}</b><br>–ü–æ–¥–æ–∂–¥–∏—Ç–µ 30‚Äì60 —Å–µ–∫ –ø–æ–∫–∞ GitHub Pages –æ–±–Ω–æ–≤–∏—Ç JSON`, "ok");
    window.open(`${JSON_BASE}${encodeURIComponent(LAST_ID)}.json`, "_blank");
    updateIframeAndPreview();
  } catch(e){ setStatus("‚ò† –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: "+e.message,"bad"); }
}

/* –ü—Ä–∏–≤—è–∑–∫–∏ */
$("publishBtn").addEventListener("click", publish);
</script>
</body>
</html>
