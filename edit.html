<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–†–µ–¥–∞–∫—Ç–æ—Ä ‚Äî Falling Items (–ö–ì–ë)</title>

  <!-- –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ -->
  <style>
    :root{
      --ui-acc:#ffd700;
      --card:#151515;
      --ink:#eee;
      --muted:#aaa;
      --stroke:#2a2a2a;
      --gap:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:#0d0d0d; color:var(--ink); font-family:Rubik,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      display:flex; flex-direction:column;
    }
    header{
      display:flex; align-items:center; gap:12px; padding:14px 18px; border-bottom:1px solid var(--stroke);
      position:sticky; top:0; background:#0d0d0d; z-index:2;
    }
    header img{height:40px}
    header h1{font-size:18px; margin:0; color:var(--ui-acc); font-weight:700}
    main{display:grid; grid-template-columns: 380px 1fr; gap:20px; padding:18px; max-width:1400px; width:100%; margin:0 auto}
    .card{
      background:var(--card); border:1px solid var(--stroke); border-radius:12px; padding:16px; box-shadow:0 0 24px rgba(255,215,0,.05);
    }
    .card h2{margin:0 0 10px; font-size:16px; color:var(--ui-acc)}
    label{display:block; margin:10px 0 6px; font-size:13px; color:#ddd}
    input[type="text"], input[type="number"], input[type="url"], textarea, select{
      width:100%; background:#101010; color:#fff; border:1px solid #333; border-radius:8px; padding:10px 12px; font-size:14px;
      outline:none; transition:border-color .15s ease, box-shadow .15s ease;
    }
    textarea{min-height:90px; resize:vertical}
    input:focus, textarea:focus, select:focus{border-color:#444; box-shadow:0 0 0 3px rgba(255,215,0,.15)}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:var(--gap)}
    .row-3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:var(--gap)}
    .inline{display:flex; gap:10px; align-items:center}
    .hint{color:var(--muted); font-size:12px; margin-top:6px}
    .pill{display:inline-block; padding:6px 10px; border:1px dashed #444; border-radius:999px; color:#bbb; font-size:12px}

    button{
      background:linear-gradient(90deg,#ffbf00,#ffd700); color:#000; border:none; border-radius:10px; font-weight:700;
      padding:12px 16px; cursor:pointer; transition:transform .15s ease, box-shadow .15s ease;
    }
    button:hover{transform:translateY(-1px); box-shadow:0 6px 20px rgba(255,215,0,.25)}
    .btn-ghost{background:transparent; color:#fff; border:1px solid #444}
    .btn-danger{background:#a80000; color:#fff}
    .stack{display:flex; flex-direction:column; gap:var(--gap)}
    .levels .level{background:#111; border:1px solid #282828; border-radius:12px; padding:14px}
    .level h3{margin:0 0 8px; font-size:14px; color:#fff; display:flex; align-items:center; justify-content:space-between}
    .toolbar{display:flex; gap:10px; flex-wrap:wrap}
    .right{display:flex; gap:10px; align-items:center; justify-content:flex-end}

    footer{padding:12px 18px; color:#888; border-top:1px solid var(--stroke); display:flex; align-items:center; justify-content:center; gap:8px}
    footer a{color:var(--ui-acc); text-decoration:none}

    /* –ü–†–ï–î–ü–†–û–°–ú–û–¢–† */
    .preview-wrap{display:grid; grid-template-rows:auto 1fr; gap:10px; height:100%}
    .preview-stage{background:#0a0a0a; border:1px dashed #333; border-radius:12px; display:flex; align-items:center; justify-content:center; padding:20px; min-height:280px}
    .preview-controls{display:grid; grid-template-columns:1fr auto; gap:10px}
    .preview-item{position:relative; display:inline-flex; align-items:center; justify-content:center; padding:14px 18px; min-width:140px; min-height:60px; transition:all .2s ease}
    .preview-item img{max-width:160px; max-height:120px; display:block}

    /* –§–ò–ì–£–†–´ */
    .shape-rect{border-radius:8px}
    .shape-rounded{border-radius:18px}
    .shape-circle{border-radius:999px; padding:18px 22px}
    .shape-diamond{transform:rotate(45deg); padding:28px}
    .shape-diamond > *{transform:rotate(-45deg)}
    .shape-star{clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)}

    /* –≠–§–§–ï–ö–¢–´ */
    .fx-shadow{box-shadow:0 8px 26px rgba(0,0,0,.45)}
    .fx-glow{box-shadow:0 0 16px var(--glow, #00f0ff)}
    .fx-3d{box-shadow:6px 6px 18px rgba(0,0,0,.45), inset -4px -4px 10px rgba(255,255,255,.25)}
    .fx-border{border-style:solid}

    /* –ò–§–†–ï–ô–ú –†–ï–ó–£–õ–¨–¢–ê–¢ */
    .result{display:grid; grid-template-columns:1fr auto; gap:10px; align-items:start}
    .result textarea{height:110px; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
  </style>

  <!-- Google Fonts –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π) -->
  <link id="gf" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap">
</head>
<body>
  <header>
    <a href="https://kgbgamecorp.ru" target="_blank" rel="noopener">
      <img src="https://con.xl.ru/fnfLZuvpAUiDaqDs8d1-2g/images/kcJYv7OsYUSGt5AfGq5jIw.png" alt="–ö–ì–ë">
    </a>
    <h1>–†–µ–¥–∞–∫—Ç–æ—Ä –∏–≥—Ä—ã ¬´–ü–∞–¥–∞—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã¬ª ‚Äî –ö–ì–ë</h1>
  </header>

  <main>
    <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ + –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
    <section class="card stack">
      <h2>‚öôÔ∏è –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

      <div class="row">
        <div>
          <label>–Ø–∑—ã–∫ / —Ä–µ–∂–∏–º</label>
          <select id="language">
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="en">English (Latin)</option>
            <option value="fr">Fran√ßais</option>
            <option value="es">Espa√±ol</option>
            <option value="de">Deutsch</option>
            <option value="zh">‰∏≠Êñá (Chinese)</option>
            <option value="ja">Êó•Êú¨Ë™û (Japanese)</option>
            <option value="math">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (LaTeX)</option>
          </select>
        </div>
        <div>
          <label>–®—Ä–∏—Ñ—Ç</label>
          <select id="font">
            <option>Rubik</option>
            <option>Roboto</option>
            <option>Open Sans</option>
            <option>Montserrat</option>
            <option>PT Sans</option>
            <option>Lobster</option>
            <option>Noto Sans</option>
            <option>Noto Sans SC (‰∏≠Êñá)</option>
            <option>Noto Sans JP (Êó•Êú¨Ë™û)</option>
            <option>Noto Sans KR (ÌïúÍµ≠Ïñ¥)</option>
            <option>Indie Flower</option>
            <option>Fredericka the Great</option>
            <option>Special Elite</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
          <input type="color" id="textColor" value="#ffffff">
        </div>
        <div>
          <label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0‚Äì1)</label>
          <input type="text" id="opacity" value="1">
          <div class="hint">–ù–∞–ø—Ä.: 1, 0.8, 0.5</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>–§–∏–≥—É—Ä–∞</label>
          <select id="shape">
            <option value="rect">–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫</option>
            <option value="rounded">–°–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–π</option>
            <option value="circle">–ö—Ä—É–≥</option>
            <option value="diamond">–†–æ–º–±</option>
            <option value="star">–ó–≤–µ–∑–¥–∞</option>
          </select>
        </div>
        <div>
          <label>–§–æ–Ω ‚Äî —Ü–≤–µ—Ç</label>
          <input type="color" id="bgColor" value="#1a1a1a">
        </div>
      </div>

      <label>–§–æ–Ω ‚Äî –∫–∞—Ä—Ç–∏–Ω–∫–∞ (URL, –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
      <input type="url" id="bgImage" placeholder="https://.../bubble.png">

      <div class="row-3">
        <div>
          <label>–†–∞–º–∫–∞ (—Ü–≤–µ—Ç)</label>
          <input type="color" id="borderColor" value="#ffffff">
        </div>
        <div>
          <label>–†–∞–º–∫–∞ (—Ç–æ–ª—â–∏–Ω–∞, px)</label>
          <input type="number" id="borderWidth" value="1" min="0">
        </div>
        <div class="inline" style="align-items:end;">
          <label style="width:100%">–†–∞–º–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞?</label>
          <input type="checkbox" id="borderOn" checked>
        </div>
      </div>

      <div class="row">
        <div class="inline">
          <input type="checkbox" id="shadowOn" checked><label for="shadowOn">–¢–µ–Ω—å</label>
        </div>
        <div class="inline">
          <input type="checkbox" id="glowOn"><label for="glowOn">–ü–æ–¥—Å–≤–µ—Ç–∫–∞</label>
          <input type="color" id="glowColor" value="#00f0ff" title="–¶–≤–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏">
        </div>
      </div>

      <div class="row">
        <div class="inline">
          <input type="checkbox" id="fx3d"><label for="fx3d">3D —ç—Ñ—Ñ–µ–∫—Ç</label>
        </div>
        <div class="inline">
          <input type="checkbox" id="randomLevels"><label for="randomLevels">–†–∞–Ω–¥–æ–º —É—Ä–æ–≤–Ω–µ–π</label>
        </div>
      </div>

      <label>–ö—É—Ä—Å–æ—Ä (URL –∫–∞—Ä—Ç–∏–Ω–∫–∏, –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
      <input type="url" id="cursorUrl" placeholder="https://.../cursor.png">

      <div class="card" style="border-style:dashed">
        <h2>üß™ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h2>
        <div class="preview-controls">
          <input type="text" id="previewValue" placeholder="–¢–µ–∫—Å—Ç –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–ª–∏ URL –∫–∞—Ä—Ç–∏–Ω–∫–∏..." value="Preview">
          <div class="right">
            <button class="btn-ghost" id="btnText">–¢–µ–∫—Å—Ç</button>
            <button class="btn-ghost" id="btnImage">–ö–∞—Ä—Ç–∏–Ω–∫–∞</button>
          </div>
        </div>
        <div class="preview-stage">
          <div id="previewItem" class="preview-item shape-rounded fx-shadow" style="--glow:#00f0ff;">
            <span id="previewText" style="font-weight:700">Preview</span>
          </div>
        </div>
        <div class="hint">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫.</div>
      </div>
    </section>

    <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –£—Ä–æ–≤–Ω–∏ + –ø—É–±–ª–∏–∫–∞—Ü–∏—è -->
    <section class="card stack">
      <h2>üéØ –£—Ä–æ–≤–Ω–∏</h2>
      <div class="levels" id="levels"></div>
      <div class="toolbar">
        <button id="addLevel">‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>
        <span class="pill">–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ —É—Ä–æ–≤–Ω–µ–π</span>
      </div>

      <h2 style="margin-top:8px">üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è</h2>
      <div class="row">
        <button id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å iframe</button>
        <button id="testBtn" class="btn-ghost">üîç –í–∞–ª–∏–¥–∞—Ü–∏—è JSON</button>
      </div>

      <div class="result" style="margin-top:10px">
        <textarea id="iframeOut" readonly placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è iframe –¥–ª—è Genially"></textarea>
        <button id="copyBtn" class="btn-ghost">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
      <div class="hint">–î–∞–Ω–Ω—ã–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ <b>texts/data/&lt;id&gt;.json</b> —á–µ—Ä–µ–∑ —Ç–≤–æ–π —Å–µ—Ä–≤–µ—Ä. GitHub Pages –º–æ–∂–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å –¥–æ 30‚Äì60 —Å–µ–∫.</div>
    </section>
  </main>

  <footer>¬© 2025 <a href="https://kgbgamecorp.ru" target="_blank" rel="noopener">–ö–æ—Ä–ø–æ—Ä–∞—Ü–∏—è –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ë—É–¥—É—â–µ–≥–æ</a></footer>

  <!-- –õ–û–ì–ò–ö–ê -->
  <script>
    // ‚Äî‚Äî‚Äî helpers ‚Äî‚Äî‚Äî
    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);

    // Google Fonts –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    function applyGoogleFont(fontName){
      const link = document.getElementById('gf');
      const family = fontName.replace(/ /g, '+');
      link.href = `https://fonts.googleapis.com/css2?family=${family}:wght@400;700&display=swap`;
      document.body.style.fontFamily = fontName + ", system-ui, sans-serif";
      // –≤ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–∂–µ
      $('#previewText').style.fontFamily = fontName + ", system-ui, sans-serif";
    }

    // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π
    function updatePreview(){
      const item = $('#previewItem');
      const text = $('#previewText');
      const val  = $('#previewValue').value.trim();
      const asImage = item.dataset.mode === 'image' || /^https?:\\/\\//i.test(val);

      // –§–∏–≥—É—Ä–∞
      const shape = $('#shape').value;
      item.classList.remove('shape-rect','shape-rounded','shape-circle','shape-diamond','shape-star');
      item.classList.add('shape-' + shape);

      // –≠—Ñ—Ñ–µ–∫—Ç—ã
      item.classList.toggle('fx-shadow', $('#shadowOn').checked);
      item.classList.toggle('fx-3d', $('#fx3d').checked);
      item.classList.toggle('fx-glow', $('#glowOn').checked);
      item.style.setProperty('--glow', $('#glowColor').value);

      // –†–∞–º–∫–∞
      if($('#borderOn').checked && Number($('#borderWidth').value) > 0){
        item.classList.add('fx-border');
        item.style.borderWidth = Number($('#borderWidth').value) + 'px';
        item.style.borderColor = $('#borderColor').value;
      } else {
        item.classList.remove('fx-border');
        item.style.borderWidth = '0px';
      }

      // –§–æ–Ω
      const bgImg = $('#bgImage').value.trim();
      const bgCol = $('#bgColor').value;
      item.style.background = bgImg ? `url(${bgImg}) center / contain no-repeat` : bgCol;

      // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å + —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
      const op = Math.max(0, Math.min(1, parseFloat($('#opacity').value || '1')));
      item.style.opacity = op;
      text.style.color = $('#textColor').value;

      // –ö–æ–Ω—Ç–µ–Ω—Ç
      if(asImage){
        item.dataset.mode = 'image';
        text.style.display = 'none';
        if(!item.querySelector('img')){
          const img = document.createElement('img');
          item.appendChild(img);
        }
        const img = item.querySelector('img');
        img.src = val || 'https://via.placeholder.com/160x120?text=Image';
      } else {
        item.dataset.mode = 'text';
        const img = item.querySelector('img');
        if(img) img.remove();
        text.style.display = 'block';
        text.textContent = val || 'Preview';
        text.style.color = $('#textColor').value;
      }

      // –ö—É—Ä—Å–æ—Ä
      const cursor = $('#cursorUrl').value.trim();
      document.body.style.cursor = cursor ? `url(${cursor}), auto` : 'auto';
    }

    // –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
    function levelTemplate(idx){
      const wrap = document.createElement('div');
      wrap.className = 'level';
      wrap.innerHTML = `
        <h3>–£—Ä–æ–≤–µ–Ω—å <span class="num">${idx+1}</span>
          <span class="right">
            <button class="btn-ghost up">‚ñ≤</button>
            <button class="btn-ghost down">‚ñº</button>
            <button class="btn-danger del">–£–¥–∞–ª–∏—Ç—å</button>
          </span>
        </h3>
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è / Target</label>
        <input type="text" class="target" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –±—É–∫–≤–∞ S –∏–ª–∏ Animals">
        <div class="row">
          <div>
            <label>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫–µ)</label>
            <textarea class="correct" placeholder="sun\nstar\nsnake\nhttps://.../cat.png\n\\frac{3}{4}"></textarea>
          </div>
          <div>
            <label>–û—Ç–≤–ª–µ–∫–∞—é—â–∏–µ –æ–±—ä–µ–∫—Ç—ã</label>
            <textarea class="wrong" placeholder="dog\napple\ncar\nhttps://.../car.png\n\\log_{2}{8}"></textarea>
          </div>
        </div>
        <div class="row">
          <div>
            <label>–¢–∞–π–º–µ—Ä —É—Ä–æ–≤–Ω—è (—Å–µ–∫.)</label>
            <input type="number" class="timer" value="30" min="5">
          </div>
          <div class="hint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: —Å–ª–æ–≤–∞, URL –∫–∞—Ä—Ç–∏–Ω–æ–∫, LaTeX-—Ñ–æ—Ä–º—É–ª—ã (math —Ä–µ–∂–∏–º).</div>
        </div>
      `;
      // —Å–æ–±—ã—Ç–∏—è
      wrap.querySelector('.del').onclick = () => { wrap.remove(); renumber(); };
      wrap.querySelector('.up').onclick  = () => { const p=wrap.previousElementSibling; if(p){ wrap.parentNode.insertBefore(wrap,p); renumber(); } };
      wrap.querySelector('.down').onclick= () => { const n=wrap.nextElementSibling; if(n){ wrap.parentNode.insertBefore(n,wrap); renumber(); } };
      return wrap;
    }
    function renumber(){
      $$('#levels .level .num').forEach((el,i)=> el.textContent = i+1);
    }
    function addLevel(){ $('#levels').appendChild(levelTemplate($$('#levels .level').length)); }

    // —Å–±–æ—Ä —Ñ–æ—Ä–º—ã ‚Üí JSON
    function collectConfig(){
      const levels = [];
      $$('#levels .level').forEach(div=>{
        levels.push({
          target: div.querySelector('.target').value.trim(),
          correct: div.querySelector('.correct').value.split('\n').map(s=>s.trim()).filter(Boolean),
          wrong:   div.querySelector('.wrong').value.split('\n').map(s=>s.trim()).filter(Boolean),
          timer:   Math.max(5, parseInt(div.querySelector('.timer').value||'30',10))
        });
      });

      const cfg = {
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ
        language: $('#language').value,
        font: $('#font').value,
        textColor: $('#textColor').value,
        style: {
          shape: $('#shape').value,
          bgColor: $('#bgColor').value,
          bgImage: $('#bgImage').value.trim(),
          borderOn: $('#borderOn').checked,
          borderColor: $('#borderColor').value,
          borderWidth: Math.max(0, parseInt($('#borderWidth').value||'0', 10)),
          shadow: $('#shadowOn').checked,
          glow: $('#glowOn').checked,
          glowColor: $('#glowColor').value,
          fx3d: $('#fx3d').checked,
          opacity: Math.max(0, Math.min(1, parseFloat($('#opacity').value||'1')))
        },
        cursor: $('#cursorUrl').value.trim(),
        randomLevels: $('#randomLevels').checked,
        // –£—Ä–æ–≤–Ω–∏
        levels
      };
      return cfg;
    }

    // –≤–∞–ª–∏–¥–∞—Ü–∏—è
    function validate(cfg){
      if(!cfg.levels.length) return '–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —É—Ä–æ–≤–µ–Ω—å.';
      for(const [i,lv] of cfg.levels.entries()){
        if(!lv.target) return `–£—Ä–æ–≤–µ–Ω—å ${i+1}: —É–∫–∞–∂–∏—Ç–µ target.`;
        if(lv.correct.length===0 && lv.wrong.length===0) return `–£—Ä–æ–≤–µ–Ω—å ${i+1}: –¥–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç.`;
      }
      return null;
    }

    // –ø—É–±–ª–∏–∫–∞—Ü–∏—è ‚Üí —Å–µ—Ä–≤–µ—Ä Render (–∫–∞–∫ –≤ readingtrainer)
    async function publish(){
      const cfg = collectConfig();
      const err = validate(cfg);
      if(err){ alert(err); return; }

      // –ø—Ä–∏–º–µ–Ω–∏–º —à—Ä–∏—Ñ—Ç –∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä—É –ø—Ä—è–º–æ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π
      applyGoogleFont(cfg.font);

      const payload = { type: "falling", data: cfg };
      try{
        const res = await fetch("https://reading-trainer-server.onrender.com/save", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if(data && data.id){
          const iframe = `<iframe src="https://nikashum93.github.io/falling/main.html?id=${data.id}" width="900" height="640" style="border:0;"></iframe>`;
          $('#iframeOut').value = iframe;
          alert('–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ! –ï—Å–ª–∏ JSON –µ—â—ë –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –ø–æ–¥–æ–∂–¥–∏—Ç–µ 30‚Äì60 —Å–µ–∫—É–Ω–¥ (–∫–µ—à GitHub Pages).');
        } else {
          alert("–û—à–∏–±–∫–∞: " + (data && data.error || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"));
        }
      }catch(e){
        alert("–°–µ—Ç—å/—Å–µ—Ä–≤–µ—Ä: " + e.message);
      }
    }

    // UI —Å–æ–±—ã—Ç–∏—è
    $('#font').addEventListener('change', e=> applyGoogleFont(e.target.value));
    ;['language','textColor','opacity','shape','bgColor','bgImage','borderColor','borderWidth','borderOn','shadowOn','glowOn','glowColor','fx3d','cursorUrl','randomLevels','previewValue']
      .forEach(id => { $('#'+id).addEventListener('input', updatePreview); $('#'+id).addEventListener('change', updatePreview); });

    $('#btnText').onclick = (e)=>{ e.preventDefault(); const it=$('#previewItem'); it.dataset.mode='text'; updatePreview(); }
    $('#btnImage').onclick= (e)=>{ e.preventDefault(); const it=$('#previewItem'); it.dataset.mode='image'; updatePreview(); }

    $('#addLevel').onclick = addLevel;
    $('#saveBtn').onclick = publish;
    $('#testBtn').onclick = ()=> {
      const cfg = collectConfig();
      const err = validate(cfg);
      if(err){ alert(err); return; }
      alert('JSON –≤–∞–ª–∏–¥–µ–Ω. –£—Ä–æ–≤–Ω–µ–π: '+cfg.levels.length);
      console.log(cfg);
    };
    $('#copyBtn').onclick = ()=> {
      $('#iframeOut').select(); document.execCommand('copy');
    };

    // init
    addLevel();
    applyGoogleFont($('#font').value);
    updatePreview();
  </script>
</body>
</html>
